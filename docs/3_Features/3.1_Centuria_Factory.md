# Centuria Theme Factory

> **Mass theme generation for ML training diversity**

The Centuria Factory generates hundreds of diverse themes to train Trinity's ML models on universal layout rules rather than theme-specific patterns.

---

## Overview

### The Problem

Traditional ML training on limited themes:

```
Model learns: "Brutalist theme + long title = overflow"
Problem: Doesn't generalize to new themes
```

### The Solution

Train on 100+ diverse themes:

```
Model learns: "Any theme + text_width > container_width = overflow"
Result: Universal DOM physics understanding
```

---

## Architecture

### Text-to-Theme Engine

**Natural language to TailwindCSS:**

```python
from trinity.components.brain import Brain

brain = Brain()

# Generate theme from description
theme = brain.generate_theme_from_vibe(
    "Cyberpunk neon city with pink and cyan accents"
)

# Returns Tailwind configuration
{
    "nav_bg": "bg-black border-b-2 border-cyan-400",
    "hero_title": "text-6xl font-black text-pink-500 uppercase",
    "card_bg": "bg-gray-900 border border-cyan-500 shadow-2xl",
    "btn_primary": "bg-pink-500 hover:bg-cyan-400 text-black"
    # ... 50+ class mappings
}
```

### Generation Pipeline

```
┌─────────────────────────────────────────────────────────────┐
│                  Centuria Factory Pipeline                   │
└─────────────────────────────────────────────────────────────┘

1. Vibe Description
   ↓
   "Cyberpunk neon city with pink and cyan"
   
2. LLM Processing
   ↓
   Ollama/GPT converts to Tailwind classes
   Temperature: 0.9 (high creativity)
   
3. Schema Validation
   ↓
   Verify 13 required components
   
4. Retry Logic
   ↓
   3 attempts if validation fails
   
5. Theme Saved
   ↓
   config/themes.yaml
```

---

## CLI Usage

### Single Theme Generation

**Generate one theme:**

```bash
trinity theme-gen "Cyberpunk neon city" --name cyberpunk
```

**Output:**

```
Theme Generator

Vibe: Cyberpunk neon city with pink and cyan
Name: cyberpunk

Theme configuration created

Preview:
  nav_bg: bg-black border-b-2 border-cyan-400
  hero_title: text-6xl font-black text-pink-500 uppercase
  card_bg: bg-gray-900 border border-cyan-500 shadow-2xl

Theme saved successfully!
Location: config/themes.yaml
Total themes: 15

Try it now:
  trinity build --theme cyberpunk
```

**Validation:**

```bash
# Name must be lowercase alphanumeric + underscore
trinity theme-gen "Cool Theme" --name Cool-Theme  # ERROR
trinity theme-gen "Cool Theme" --name cool_theme  # OK

# Duplicate detection
trinity theme-gen "New vibe" --name brutalist
# WARNING: Theme 'brutalist' already exists
# Overwrite? [y/N]
```

### Mass Theme Generation

**Generate 100 themes:**

```bash
python scripts/mass_theme_generator.py --count 100
```

**Dry-run preview:**

```bash
python scripts/mass_theme_generator.py --dry-run
```

**Output:**

```
Centuria Factory - Mass Theme Generator

Configuration:
  Total themes: 100 (5 categories × 20 each)
  Output: config/themes.yaml
  LLM: ollama/llama3.2:3b

Generating Historical themes...
  [████████████████████] 20/20 (2m 15s)

Generating Tech themes...
  [████████████████████] 20/20 (2m 10s)

Generating Artistic themes...
  [████████████████████] 20/20 (2m 18s)

Generating Chaotic themes...
  [████████████████████] 20/20 (2m 05s)

Generating Professional themes...
  [████████████████████] 20/20 (2m 12s)

Summary:
  Total generated: 100 themes
  Time elapsed: 10m 50s
  Success rate: 98% (98/100)
  Failed: 2 (retrying...)

Themes saved to: config/themes.yaml
```

---

## Theme Categories

### 1. Historical (20 themes)

Themes based on historical design movements:

```python
historical_vibes = [
    "Victorian ornate with gold and burgundy",
    "Art Deco geometric with black and gold",
    "1950s retro with pastels and curves",
    "1980s Memphis design with bold shapes",
    "Y2K futuristic with chrome and gradients",
    "Bauhaus minimalist with primary colors",
    "Art Nouveau flowing organic forms",
    # ... 13 more
]
```

### 2. Tech (20 themes)

Technology and software-inspired:

```python
tech_vibes = [
    "DOS terminal with green monospace",
    "Material Design with elevation shadows",
    "iOS flat design with rounded corners",
    "Vaporwave aesthetic with pink and teal",
    "Cyberpunk neon with dark backgrounds",
    "Matrix code rain with green text",
    "Windows 95 grey with blue accents",
    # ... 13 more
]
```

### 3. Artistic (20 themes)

Art movements and styles:

```python
artistic_vibes = [
    "Cubist fragmented with earth tones",
    "Pop Art bold with Lichtenstein dots",
    "Abstract expressionist with paint splatters",
    "Swiss design with grids and Helvetica",
    "Japanese minimalism with negative space",
    "Graffiti street art with spray paint",
    "Impressionist soft with pastel blends",
    # ... 13 more
]
```

### 4. Chaotic (20 themes)

Intentionally difficult layouts for training:

```python
chaotic_vibes = [
    "Glitch art with corrupted pixels",
    "Comic Sans maximum chaos",
    "Rainbow gradient overload",
    "BSOD Windows error screen",
    "Newspaper classified ads density",
    "Late 90s GeoCities with animations",
    "Trashcore collage aesthetic",
    # ... 13 more
]
```

### 5. Professional (20 themes)

Industry-specific designs:

```python
professional_vibes = [
    "Legal firm conservative with navy",
    "Medical clean with white and blue",
    "Financial tech with charts and data",
    "Government official with flags",
    "Academic journal with citations",
    "Corporate enterprise with blues",
    "Startup modern with gradients",
    # ... 13 more
]
```

---

## Implementation

### Theme Generation Function

```python
def generate_theme_from_vibe(
    self, 
    vibe_description: str,
    max_retries: int = 3
) -> Dict[str, str]:
    """
    Convert natural language style description to TailwindCSS.
    
    Args:
        vibe_description: Style description (e.g., "Cyberpunk neon")
        max_retries: Number of retry attempts
        
    Returns:
        Dictionary with 13 required components:
        - nav_bg, nav_text, nav_link
        - hero_bg, hero_title, hero_subtitle
        - card_bg, card_title, card_text
        - btn_primary, btn_secondary
        - footer_bg, footer_text
        
    Raises:
        ThemeGenerationError: If validation fails after retries
    """
    
    prompt = f"""
Generate a TailwindCSS theme configuration for: {vibe_description}

Return ONLY a JSON object with these 13 keys:
- nav_bg, nav_text, nav_link
- hero_bg, hero_title, hero_subtitle
- card_bg, card_title, card_text
- btn_primary, btn_secondary
- footer_bg, footer_text

Values should be complete TailwindCSS class strings.

Example:
{{
  "nav_bg": "bg-gray-900 border-b border-gray-700",
  "nav_text": "text-gray-100",
  "nav_link": "hover:text-blue-400 transition"
}}
"""
    
    for attempt in range(1, max_retries + 1):
        # Generate with high creativity
        response = self.llm_client.generate(
            prompt=prompt,
            temperature=0.9,  # High diversity
            max_tokens=1000
        )
        
        # Parse and validate
        try:
            theme = json.loads(response)
            
            # Validate required keys
            required_keys = [
                "nav_bg", "nav_text", "nav_link",
                "hero_bg", "hero_title", "hero_subtitle",
                "card_bg", "card_title", "card_text",
                "btn_primary", "btn_secondary",
                "footer_bg", "footer_text"
            ]
            
            if all(key in theme for key in required_keys):
                logger.info(f"Theme generated (attempt {attempt})")
                return theme
            else:
                missing = set(required_keys) - set(theme.keys())
                logger.warning(f"Missing keys: {missing}")
                
        except json.JSONDecodeError as e:
            logger.warning(f"Invalid JSON (attempt {attempt}): {e}")
    
    raise ThemeGenerationError(
        f"Failed to generate valid theme after {max_retries} attempts"
    )
```

### Mass Generator Script

```python
# scripts/mass_theme_generator.py

from pathlib import Path
from rich.progress import track
import yaml

def generate_mass_themes(
    count: int = 100,
    dry_run: bool = False
) -> Dict[str, Dict]:
    """
    Generate multiple themes across categories.
    
    Args:
        count: Total themes to generate (divisible by 5)
        dry_run: Preview without saving
        
    Returns:
        Dictionary of generated themes
    """
    
    per_category = count // 5
    all_themes = {}
    
    categories = {
        "historical": get_historical_vibes(),
        "tech": get_tech_vibes(),
        "artistic": get_artistic_vibes(),
        "chaotic": get_chaotic_vibes(),
        "professional": get_professional_vibes()
    }
    
    brain = Brain()
    
    for category, vibes in categories.items():
        logger.info(f"Generating {category} themes...")
        
        for vibe in track(vibes[:per_category], description=category):
            theme_name = sanitize_name(vibe)
            
            try:
                theme = brain.generate_theme_from_vibe(vibe)
                theme["_meta"] = {
                    "category": category,
                    "vibe": vibe,
                    "generated_at": datetime.now().isoformat()
                }
                
                all_themes[theme_name] = theme
                logger.info(f"✓ {theme_name}")
                
            except Exception as e:
                logger.error(f"✗ {theme_name}: {e}")
    
    if not dry_run:
        # Save to YAML
        themes_path = Path("config/themes.yaml")
        
        # Merge with existing
        if themes_path.exists():
            with open(themes_path) as f:
                existing = yaml.safe_load(f) or {}
            
            all_themes = {**existing, **all_themes}
        
        # Save
        with open(themes_path, 'w') as f:
            yaml.dump(all_themes, f, default_flow_style=False)
        
        logger.info(f"Saved {len(all_themes)} themes to {themes_path}")
    
    return all_themes
```

---

## ML Training Benefits

### Before Centuria Factory

**Training data:**
- 15 themes (limited diversity)
- 182 training samples
- Model learns theme-specific patterns

**Problem:**
```
Model: "Brutalist theme + long title = overflow"
New theme: "Minimalist theme + long title = ?"
Model: "No idea, never seen minimalist before"
```

### After Centuria Factory

**Training data:**
- 100+ themes (high diversity)
- 10,000+ training samples
- Model learns universal layout rules

**Solution:**
```
Model: "text_width > container_width = overflow"
New theme: "Any theme + text_width > container_width = overflow"
Model: "Will overflow regardless of theme aesthetics"
```

### Transfer Learning

**Universal Features Learned:**

1. **Text Flow Physics**
   - Font size vs container width
   - Word length vs available space
   - Line height vs vertical space

2. **Layout Constraints**
   - Grid item sizing
   - Flexbox wrapping
   - Absolute positioning limits

3. **CSS Cascade Rules**
   - Specificity conflicts
   - Inheritance patterns
   - Override strategies

**Result:** Model generalizes to **unseen themes** without retraining.

---

## Performance

### Generation Speed

| Operation | Time | Notes |
|-----------|------|-------|
| Single theme | 6-12s | Depends on LLM speed |
| 100 themes | 10-15m | Parallel possible |
| Validation | <100ms | Schema check |

### Quality Metrics

| Metric | Value | Notes |
|--------|-------|-------|
| **Success Rate** | 98% | Valid theme generated |
| **Retry Rate** | 15% | Needs 2nd attempt |
| **Failure Rate** | 2% | Fails after 3 attempts |
| **Theme Diversity** | High | Measured by feature variance |

---

## Configuration

**config/settings.yaml:**

```yaml
theme_generation:
  # LLM settings
  provider: ollama
  model: llama3.2:3b
  temperature: 0.9  # High creativity
  max_tokens: 1000
  
  # Validation
  required_components: 13
  max_retries: 3
  
  # Mass generation
  categories:
    - historical
    - tech
    - artistic
    - chaotic
    - professional
  
  themes_per_category: 20
  
  # Output
  output_path: config/themes.yaml
  backup_on_merge: true
```

---

## Future Enhancements

### Planned Features (v0.9.0+)

**1. Style Transfer**
- Upload screenshot → extract theme
- Automatic color palette extraction
- Typography analysis

**2. Theme Variations**
- Generate dark/light variants
- Accessibility improvements
- High contrast modes

**3. A/B Testing**
- Generate multiple variants
- Collect user preferences
- ML-guided optimization

**4. Component Library**
- Reusable theme components
- Mix and match palettes
- Preset combinations

---

## Next Steps

- [Self-Healing Layouts](./3.0_Self_Healing.md) - How themes are validated
- [Neural-Symbolic Architecture](../1_Architecture/1.0_Neural_Symbolic.md) - Training pipeline
- [LLM Caching](../4_LLM_Agents/4.0_LLM_Caching.md) - Speed up generation
